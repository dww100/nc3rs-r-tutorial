<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="David W. Wright">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Advanced Graphing II - NC3Rs R Tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Advanced Graphing II";
    var mkdocs_page_input_path = "advanced_graphing_ii.md";
    var mkdocs_page_url = "/advanced_graphing_ii/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> NC3Rs R Tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../intro/">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../data_from_files/">Reading data from files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../processing_data/">Working with data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../scripting/">Scripting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../basic_graphing/">Basic Graphing</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../ggplot2/">Introducing ggplot2</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../advanced_graphing/">Advanced Graphing I</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Advanced Graphing II</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#improving-plot-appearance-in-ggplot2">Improving plot appearance in ggplot2</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#labelling-datapoints">Labelling datapoints</a></li>
        
            <li><a class="toctree-l3" href="#polishing-the-appearance">Polishing the appearance</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">NC3Rs R Tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Advanced Graphing II</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/dww100/nc3rs-r-tutorial/edit/master/docs/advanced_graphing_ii.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="improving-plot-appearance-in-ggplot2">Improving plot appearance in ggplot2</h1>
<p>Our graph now contains most of the functional data from the Economist graph.
However, it misses the labels added to highlight some countries of note and doesn't yet look very attractive.
Lets put those things right.</p>
<h2 id="labelling-datapoints">Labelling datapoints</h2>
<p>The Economist chose to pick out a subset of countries to highlight.
To do the same in <em>R</em> we need to create a list of the datapoints we are interested in.
To create a list in <em>R</em> we use the <code>c</code> function:</p>
<pre><code>&gt;target_countries &lt;- c(
  &quot;Russia&quot;, &quot;Venezuela&quot;, &quot;Iraq&quot;, &quot;Myanmar&quot;, &quot;Sudan&quot;,
  &quot;Afghanistan&quot;, &quot;Congo&quot;, &quot;Greece&quot;, &quot;Argentina&quot;, &quot;Brazil&quot;,
  &quot;India&quot;, &quot;Italy&quot;, &quot;China&quot;, &quot;South Africa&quot;, &quot;Spane&quot;,
  &quot;Botswana&quot;, &quot;Cape Verde&quot;, &quot;Bhutan&quot;, &quot;Rwanda&quot;, &quot;France&quot;,
  &quot;United States&quot;, &quot;Germany&quot;, &quot;Britain&quot;, &quot;Barbados&quot;, &quot;Norway&quot;, &quot;Japan&quot;,
  &quot;New Zealand&quot;, &quot;Singapore&quot;
  )
</code></pre>

<p>Now we need to pick out the data for these countries from <code>econ</code>.
The operator <code>%in%</code> can be used to match entries in <code>econ$Country</code> that appear in the <code>target_countries</code> list we just made.
We can combine this with the <code>subset</code> function to get the data we want:</p>
<pre><code>&gt;labeled_countries &lt;- subset(econ, Country %in% target_countries)
</code></pre>

<p>This graph has a lot of closely packed datapoints and we don't want our labels to overlap.
This means we need a non-standard text labelling <em>geom</em>.
Load the <em>ggrepel</em> library to add this to our environment.</p>
<pre><code>library(ggrepel)
</code></pre>

<p>The <em>geom</em> we want is <code>geom_text_repel</code>.
As we only want to label the countries in <code>labeled_countries</code> we need to set the <code>data</code> option for this <em>geom</em>, rather than using the default inhereted from <code>ggplot</code> (in this case <code>econ</code>).
Try creating teh labelled graph using:</p>
<pre><code>&gt;ggplot(econ, aes(x = CPI, y = HDI)) + 
  geom_point(aes(color = Region), shape = 1, stroke = 1, size = 2.5) +
  geom_text_repel(aes(label = Country), data = labeled_countries, force = 10) +
  stat_smooth(method = &quot;lm&quot;, formula = y ~ log(x), se = FALSE, color = &quot;red&quot;, size = 0.5) 
</code></pre>

<p><img alt="" src="../images/economist-labelled.png" /></p>
<h2 id="polishing-the-appearance">Polishing the appearance</h2>
<p>Now all we need to do is improve the aesthetics of our graph.
In this step we will combine a few tweaks; Adjusting and labelling the the x and y scales and improving the colour scheme used.</p>
<p>So far, we have accepted the default colouring of the points.
An excellent resource for palettes which add clarity to your graphics is <a href="http://colorbrewer2.org">Color Brewer</a>.
Fortunately, many of their colour schemes are built into the packages we have loaded, here we will chose the <code>Paired</code> palette.</p>
<p>An improved plot can be produced using the command below. Can you identify the additions which alter each element of the graph?</p>
<pre><code>&gt;ggplot(econ, aes(x = CPI, y = HDI)) + 
  geom_point(aes(color = Region), shape = 1, stroke = 1, size = 2.5) +
  geom_text_repel(aes(label = Country), data = labeled_countries, force = 10, color = &quot;gray20&quot;) +
  stat_smooth(method = &quot;lm&quot;, formula = y ~ log(x), se = FALSE, color = &quot;red&quot;, size = 0.5) +
  scale_x_continuous(name = &quot;Corruption Perceptions Index, 2011 (10=least corrupt)&quot;,
  limits = c(.9, 10.5),
  breaks = 1:10) +
  scale_y_continuous(name = &quot;Human Development Index, 2011 (1=Best)&quot;,
  limits = c(0.2, 1.0),
  breaks = seq(0.2, 1.0, by = 0.1)) +
  scale_colour_brewer(palette=&quot;Paired&quot;, direction = 1) 
</code></pre>

<p><img alt="" src="../images/economist-axes.png" /></p>
<p>In <em>ggplot2</em> nearly all aspects of the appearance of your graph can be edited.
Many of the standard things you want to edit (font size, background colour, etc.) are grouped together as part of what is called the <code>theme</code>.
Look at the help using <code>?theme</code> to see all of the elements of teh plot you can change.
A theme is added to a <code>ggplot</code> object in the same way as elements such as <em>geoms</em>.</p>
<p>Thankfully, we don't have to edit each element individually.
There are pre-selected themes available. 
Here we use the <code>theme_minimal</code> selections and then customize it further.
We add a horizontal grid in line with the y axis tic marks and move the legend to the top of the plot.</p>
<pre><code>&gt;ggplot(econ, aes(x = CPI, y = HDI)) + 
  geom_point(aes(color = Region), shape = 1, stroke = 1, size = 2.5) +
  geom_text_repel(aes(label = Country), data = labeled_countries, force = 10, color = &quot;gray20&quot;) +
  stat_smooth(method = &quot;lm&quot;, formula = y ~ log(x), se = FALSE, color = &quot;red&quot;, size = 0.5) +
  scale_x_continuous(name = &quot;Corruption Perceptions Index, 2011 (10=least corrupt)&quot;,
  limits = c(.9, 10.5),
  breaks = 1:10) +
  scale_y_continuous(name = &quot;Human Development Index, 2011 (1=Best)&quot;,
  limits = c(0.2, 1.0),
  breaks = seq(0.2, 1.0, by = 0.1)) +
  scale_colour_brewer(palette=&quot;Paired&quot;, direction = 1) +
  theme_minimal() +
  theme(
    legend.position = c(&quot;top&quot;),
    legend.direction = &quot;horizontal&quot;,
    panel.grid.major = element_line(color = &quot;gray50&quot;, size = 0.5),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank()
  )
</code></pre>

<p><img alt="" src="../images/economist-themed.png" /></p>
<p>This is the end of the tutorial.
You now have a rather lovely looking plot and a good approximation of the Economist plot.
You should play with all of the options that have been introduced to you and see if you can improve the likeness (for example adding a title).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../advanced_graphing/" class="btn btn-neutral" title="Advanced Graphing I"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p><p>Created by David W. Wright</p> <img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"> This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/"/>Creative Commons Attribution-ShareAlike 4.0 International License.</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/dww100/nc3rs-r-tutorial" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../advanced_graphing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
